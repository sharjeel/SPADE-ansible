---
 - name: Setup SPADE and its pre-requisites on Ubuntu
   hosts: all
   vars:
        adt_bundle_base_url: http://dl.google.com/android/adt/
        adt_bundle_filename: adt-bundle-linux-x86_64-20130729
        adt_bundle_url: '{{ adt_bundle_base_url + adt_bundle_filename + ".zip" }}'
        adt_bundle_dest_dir: ~/adt-bundle
   tasks:
        # Install pre-requisites
        - name: Install svn, make, gcc and other required standard tools
          tags: [common]
          apt: pkg={{ item }} state=installed
          sudo: yes
          with_items:
           - gcc 
           - make 
           - subversion 
           - libaudit-dev 
           - auditd 
           - libfuse-dev 
           - fuse-utils
           - graphviz
           - ia32-libs

        # Install pre-requisites
        - name: Install svn, make, gcc and other required standard tools
          tags: [fuse-utils]
          sudo: yes
          apt: pkg={{ item }} state=installed
          when: (ansible_distribution == 'Ubuntu' and ansible_lsb.major_release|int < 13) or (ansible_distribution == 'Mint' and ansible_lsb.major_release|int < 17) 
          
        # Install Oracle Java7
        - name: add Java PPA
          tags: [java]
          sudo: yes
          apt_repository: repo=ppa:webupd8team/java state=present

        - name: automatically accept Java license
          tags: [java]
          sudo: yes
          shell: echo oracle-java7-installer shared/accepted-oracle-license-v1-1 select true | /usr/bin/debconf-set-selections
          
        - name: install Java 7
          tags: [java]
          apt: pkg='{{ item }}' state=present update_cache=yes
          with_items:
            - oracle-java7-installer
            - oracle-jdk7-installer
            - oracle-java7-set-default
            - jython

        # Android
        - include: includes/android.yml

        # SPADE
        - include: includes/spade.yml


        - pause: prompt="SPADE has been checked into directory '~/workspace/spade'. To compile, cd into this directory and run './configure && make'. For further information please refer to 'https://code.google.com/p/data-provenance/wiki/ControlClient'. Press enter to continue."
          tags: [spade]
        
   handlers:
        - name: extract Android SDK
          sudo: no
          tags: [android]
          shell: unzip ~/tmp/{{ adt_bundle_filename }}.zip -d ~/bin/

